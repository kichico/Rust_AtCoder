A:Deque
B:先にmm判定->hh判定するとよい
C:ひたすらSetにぶち込んでいく、C<B
D:遅延セグ木でぶん殴る